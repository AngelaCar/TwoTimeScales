<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="TwoTimeScales">
<title>Smooth hazards with one time scale • TwoTimeScales</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Smooth hazards with one time scale">
<meta property="og:description" content="TwoTimeScales">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary" data-bs-theme="dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">TwoTimeScales</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/index.html">Vignettes</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    functions
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/AngelaCar/TwoTimeScales">
    <span class="fa fa-github fa-lg fab"></span>
     
    github
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Smooth hazards with one time scale</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/AngelaCar/TwoTimeScales/blob/HEAD/vignettes/onetime.Rmd" class="external-link"><code>vignettes/onetime.Rmd</code></a></small>
      <div class="d-none name"><code>onetime.Rmd</code></div>
    </div>

    
    
<p>Disclaimer: the current version of the package and of this vignette
is a work-in-progress! Details might change with future updates and this
vignette will be updated consequently.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/AngelaCar/TwoTimeScales" class="external-link">TwoTimeScales</a></span><span class="op">)</span></span></code></pre></div>
<p>We assume that the reader of this vignette has some familiarity with
the <span class="math inline">\(P\)</span>-splines model for the hazard,
and with the basic functions of the package introduced in the vignette
<em>Introduction to TwoTimeScales</em>.</p>
<p>This vignette demonstrates in details how to use the package
<code>TwoTimeScales</code> to estimate a smooth hazard model with one
time scale, and how to plot the estimates. We use the dataset
<code>reccolon2ts</code> included in the package, and we analyse
mortality after recurrence of the colon cancer, over time since
recurrence. For an overview of the data use:
<code><a href="../reference/reccolon2ts.html">help(reccolon2ts)</a></code>.</p>
<div class="section level3">
<h3 id="data-preparation">Data preparation<a class="anchor" aria-label="anchor" href="#data-preparation"></a>
</h3>
<p>The first step of the analysis, is data preparation. Data are in wide
format, with one row for each patient. To estimate a <span class="math inline">\(P\)</span>-spline model for the hazard we need to
bin the individual data, that is exposure times and event counts, into
many small bins of equal size, that cover the whole range of values for
the time scale. Data preparation involves the construction of the bins
and the actual binning of the data. Both steps are implemented and
performed by the function <code><a href="../reference/prepare_data.html">prepare_data()</a></code>, which requires as
inputs the individual data vectors and the desired specification for the
bins. The function returns an object of type <code>data2ts</code>.The
<code>print</code> method can be used to analyse the structure of the
resulting object.</p>
<p>First, we show how the function works with minimal input (that is, by
using the default values for any optional parameter):</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dt1ts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_data.html">prepare_data</a></span><span class="op">(</span>s_out <span class="op">=</span> <span class="va">reccolon2ts</span><span class="op">$</span><span class="va">timesr</span>,</span>
<span>                      events <span class="op">=</span> <span class="va">reccolon2ts</span><span class="op">$</span><span class="va">status</span>,</span>
<span>                      ds <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span>
<span><span class="co">#&gt; `s_in = NULL`. I will use `s_in = 0` for all observations.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">dt1ts</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 2</span></span>
<span><span class="co">#&gt;  $ bins   :List of 3</span></span>
<span><span class="co">#&gt;   ..$ bins_s: num [1:92] 0 30 60 90 120 150 180 210 240 270 ...</span></span>
<span><span class="co">#&gt;   ..$ mids  : num [1:91] 15 45 75 105 135 165 195 225 255 285 ...</span></span>
<span><span class="co">#&gt;   ..$ ns    : int 91</span></span>
<span><span class="co">#&gt;  $ bindata:List of 2</span></span>
<span><span class="co">#&gt;   ..$ r: num [1:91] 13674 13070 12474 12002 11534 ...</span></span>
<span><span class="co">#&gt;   ..$ y: num [1:91] 14 24 16 11 24 22 20 10 24 26 ...</span></span>
<span><span class="co">#&gt;  - attr(*, "class")= chr "data2ts"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">dt1ts</span><span class="op">)</span></span>
<span><span class="co">#&gt; An object of class 'data2ts'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Data:</span></span>
<span><span class="co">#&gt; List of 2</span></span>
<span><span class="co">#&gt;  $ bins   :List of 3</span></span>
<span><span class="co">#&gt;  $ bindata:List of 2</span></span>
<span><span class="co">#&gt;  - attr(*, "class")= chr "data2ts"</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Range covered by the bins: </span></span>
<span><span class="co">#&gt; $bins_s</span></span>
<span><span class="co">#&gt; [1]    0 2730</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of bins: </span></span>
<span><span class="co">#&gt; $ns</span></span>
<span><span class="co">#&gt; [1] 91</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Overview of the binned data:</span></span>
<span><span class="co">#&gt; [1] "Total exposure time: 246018"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [1] "Total number of events: 409"</span></span></code></pre></div>
<p>The function requires as minimal inputs only a vector of exit times
(<code>s_out</code>), a vector of event’s indicators
(<code>events</code>) and the desired bins’ size (<code>ds</code>). The
object <code>dt1ts</code> is a list with two elements. The first element
is a list of bins (<code>bins_s</code>) with their midpoints
(<code>mids</code>) and the total number of bins (<code>ns</code>). The
second element of the list is another list with the data binned, a
vector of exposure times called <code>r</code> and a vector of counts of
events <code>y</code>.</p>
<p>We notice that the calling generated the message
<code>s_in = NULL. I will use s_in = 0 for all observations.</code>;
this message is informing the user that a vector of entry times was not
provided. It is assumed that the entry times are not left truncated
(everyone is observed from the beginning of the process), and
considering <code>s_in = 0</code> is therefore correct. As explained in
the introductory vignette, we included some artificial left truncated
times for the entry into the risk set. In fact, when we use the variable
that includes left truncation, the message disappears:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dt1ts_lt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_data.html">prepare_data</a></span><span class="op">(</span>s_in <span class="op">=</span> <span class="va">reccolon2ts</span><span class="op">$</span><span class="va">entrys</span>,</span>
<span>                         s_out <span class="op">=</span> <span class="va">reccolon2ts</span><span class="op">$</span><span class="va">timesr</span>,</span>
<span>                         events <span class="op">=</span> <span class="va">reccolon2ts</span><span class="op">$</span><span class="va">status</span>,</span>
<span>                         ds <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span></code></pre></div>
<p>Without specifying additional inputs, the constructions of the bins
is done by covering the minimum range of values for the time scale, with
bins of desired size <code>ds</code>. We can change the width of the
bins by changing the argument <code>ds</code>. For example, the
following code builds one bin each 90 days, approximately 3 months. As
consequence, the number of bins is about 3 times less than in the
previous case.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dt1ts_lt2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_data.html">prepare_data</a></span><span class="op">(</span>s_in <span class="op">=</span> <span class="va">reccolon2ts</span><span class="op">$</span><span class="va">entrys</span>,</span>
<span>                          s_out <span class="op">=</span> <span class="va">reccolon2ts</span><span class="op">$</span><span class="va">timesr</span>,</span>
<span>                          events <span class="op">=</span> <span class="va">reccolon2ts</span><span class="op">$</span><span class="va">status</span>,</span>
<span>                          ds <span class="op">=</span> <span class="fl">90</span><span class="op">)</span></span>
<span><span class="va">dt1ts_lt2</span><span class="op">$</span><span class="va">bins</span><span class="op">$</span><span class="va">ns</span></span>
<span><span class="co">#&gt; [1] 31</span></span></code></pre></div>
<p>It is also possible to specify minimum and maximum values for the
bins. This option can be helpful when, for example, the event times are
left-truncated but it is still desirable to have bins starting at 0.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">reccolon2ts</span><span class="op">$</span><span class="va">timesr</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]    3 2725</span></span>
<span><span class="va">dt1ts_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_data.html">prepare_data</a></span><span class="op">(</span>s_in <span class="op">=</span> <span class="va">reccolon2ts</span><span class="op">$</span><span class="va">entrys</span>,</span>
<span>                        s_out <span class="op">=</span> <span class="va">reccolon2ts</span><span class="op">$</span><span class="va">timesr</span>,</span>
<span>                        events <span class="op">=</span> <span class="va">reccolon2ts</span><span class="op">$</span><span class="va">status</span>,</span>
<span>                        ds <span class="op">=</span> <span class="fl">30</span>, min_s <span class="op">=</span> <span class="fl">0</span>, max_s <span class="op">=</span> <span class="fl">3000</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">dt1ts_2</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 2</span></span>
<span><span class="co">#&gt;  $ bins   :List of 3</span></span>
<span><span class="co">#&gt;   ..$ bins_s: num [1:101] 0 30 60 90 120 150 180 210 240 270 ...</span></span>
<span><span class="co">#&gt;   ..$ mids  : num [1:100] 15 45 75 105 135 165 195 225 255 285 ...</span></span>
<span><span class="co">#&gt;   ..$ ns    : int 100</span></span>
<span><span class="co">#&gt;  $ bindata:List of 2</span></span>
<span><span class="co">#&gt;   ..$ r: num [1:100] 12613 12322 11793 11399 10969 ...</span></span>
<span><span class="co">#&gt;   ..$ y: num [1:100] 14 24 16 11 24 22 20 10 24 26 ...</span></span>
<span><span class="co">#&gt;  - attr(*, "class")= chr "data2ts"</span></span></code></pre></div>
<p>Now 100 bins have been created, spanning the range from 0 days to
3000 days of follow-up.</p>
<p>When the aim of the analysis is to estimate a proportional hazard
model, a different structure of the data is required (<span class="citation">Carollo et al. (2023)</span>). In particular, when only
one time scale is considered, we need to create a matrix of exposure
times <code>R</code> with dimension <code>n</code> (number of
individuals in the data) by <code>ns</code> (number of bins). Similarly
for the matrix of event counts. The function <code><a href="../reference/prepare_data.html">prepare_data()</a></code>
returns data with this structure by specifying the optional input
<code>individual = TRUE</code>. It is possible, and recommended, to
provide the covariates that one wishes to use in the PH model in the
extra argument <code>covs</code>. The function will take care of the
preparation of the regression matrix <code>Z</code>. However, if
desired, this can also be prepared externally (in which case a warning
will be returned).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">covs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">reccolon2ts</span>, select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rx"</span>, <span class="st">"node4"</span>, <span class="st">"sex"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dt1ts_cov</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_data.html">prepare_data</a></span><span class="op">(</span>s_in <span class="op">=</span> <span class="va">reccolon2ts</span><span class="op">$</span><span class="va">entrys</span>,</span>
<span>                          s_out <span class="op">=</span> <span class="va">reccolon2ts</span><span class="op">$</span><span class="va">timesr</span>,</span>
<span>                          events <span class="op">=</span> <span class="va">reccolon2ts</span><span class="op">$</span><span class="va">status</span>,</span>
<span>                          ds <span class="op">=</span> <span class="fl">30</span>,</span>
<span>                          individual <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                          covs <span class="op">=</span> <span class="va">covs</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">dt1ts_cov</span><span class="op">)</span></span>
<span><span class="co">#&gt; An object of class 'data2ts'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Data:</span></span>
<span><span class="co">#&gt; List of 2</span></span>
<span><span class="co">#&gt;  $ bins   :List of 3</span></span>
<span><span class="co">#&gt;  $ bindata:List of 3</span></span>
<span><span class="co">#&gt;  - attr(*, "class")= chr "data2ts"</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Range covered by the bins: </span></span>
<span><span class="co">#&gt; $bins_s</span></span>
<span><span class="co">#&gt; [1]    0 2730</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of bins: </span></span>
<span><span class="co">#&gt; $ns</span></span>
<span><span class="co">#&gt; [1] 91</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Overview of the binned data:</span></span>
<span><span class="co">#&gt; [1] "Total exposure time: 236006"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [1] "Total number of events: 409"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Covariates:</span></span>
<span><span class="co">#&gt; [1] "Lev"     "Lev+5FU" "node4"   "male"</span></span></code></pre></div>
<p>From <code>print(dt1ts_cov)</code>, we see that 4 covariates are
included in the Z regression matrix. The variable <code>"rx"</code>
includes 3 categories, and it is therefore represented in the regression
matrix by two dummy variables (<code>"Lev"</code> and
<code>"Lev+5FU"</code>).</p>
</div>
<div class="section level3">
<h3 id="estimation">Estimation<a class="anchor" aria-label="anchor" href="#estimation"></a>
</h3>
<p>First, we show how to estimate a model without covariates. The
proportional hazard model is introduced in a second step. The function
that estimates the model is <code><a href="../reference/fit1ts.html">fit1ts()</a></code>, that is a wrap around
several other functions, performing the estimation. The estimation is
done in two steps: First, given a set of values for the smoothing
parameter, or one single starting value, a search for the model with
minimum AIC (or BIC) is performed. Once the model with minimum AIC (or
BIC) is identified, the optimal smoothing parameter is selected and the
optimal model is finally estimated.</p>
<p>For details of each argument of <code><a href="../reference/fit1ts.html">fit1ts()</a></code> we refer to the
manual or the function documentation, which can be accessed by
<code><a href="../reference/fit1ts.html">help("fit1ts")</a></code>. Here, we show how to modify the different
arguments to estimate the one time scale model in different ways.</p>
<p>The only required argument is <code>data1ts</code>, which is an
object returned by the function <code><a href="../reference/prepare_data.html">prepare_data()</a></code>, as we have
seen in the previous section. When this argument, and no other argument
is passed to <code><a href="../reference/fit1ts.html">fit1ts()</a></code>, estimation is performed with all the
default options. In most scenarios, the user will want to use
<code><a href="../reference/prepare_data.html">prepare_data()</a></code> to perform data preparation and then
directly pass the output of <code><a href="../reference/prepare_data.html">prepare_data()</a></code> to
<code><a href="../reference/fit1ts.html">fit1ts()</a></code>. However, if the available data are already
aggregated into vectors of event’s counts and exposure times, the user
can pass these as arguments to <code><a href="../reference/fit1ts.html">fit1ts()</a></code>, to <code>y</code>
and <code>r</code> respectively. In this case is necessary to provide
values for <code>bins</code> too, and it is important that all three
arguments are provided and that the length of <code>y</code>,
<code>r</code> and <code>bins$mids</code> are the same.</p>
<p>First, we only pass as argument the object <code>dt1ts</code>, which
was created before. Then, we show, only as illustration, how the same
estimates of the <span class="math inline">\(\alpha\)</span> are
obtained when we pass the arguments <code>y</code>, <code>r</code> and
<code>bins</code>, taken from the same object.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Model 1 - Default parameters (numerical optimization of aic, default param for</span></span>
<span><span class="co">#                               B-splines)</span></span>
<span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit1ts.html">fit1ts</a></span><span class="op">(</span>data1ts <span class="op">=</span> <span class="va">dt1ts</span><span class="op">)</span></span>
<span><span class="co"># Model 2 - Single data inputs</span></span>
<span><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit1ts.html">fit1ts</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">dt1ts</span><span class="op">$</span><span class="va">bindata</span><span class="op">$</span><span class="va">y</span>, r <span class="op">=</span> <span class="va">dt1ts</span><span class="op">$</span><span class="va">bindata</span><span class="op">$</span><span class="va">r</span>, bins <span class="op">=</span> <span class="va">dt1ts</span><span class="op">$</span><span class="va">bins</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">m1</span><span class="op">$</span><span class="va">optimal_model</span><span class="op">$</span><span class="va">alpha</span> <span class="op">==</span> <span class="va">m2</span><span class="op">$</span><span class="va">optimal_model</span><span class="op">$</span><span class="va">alpha</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; TRUE </span></span>
<span><span class="co">#&gt;   13</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 3</span></span>
<span><span class="co">#&gt;  $ optimal_model :List of 9</span></span>
<span><span class="co">#&gt;   ..$ alpha   : num [1:13, 1] -6.96 -6.57 -6.22 -6.14 -6.28 ...</span></span>
<span><span class="co">#&gt;   ..$ SE_alpha: num [1:13] 0.3466 0.1197 0.0893 0.0983 0.1221 ...</span></span>
<span><span class="co">#&gt;   ..$ eta     : num [1:91, 1] -6.55 -6.51 -6.48 -6.44 -6.4 ...</span></span>
<span><span class="co">#&gt;   ..$ H       : num [1:13, 1:13] 0.16707 0.0782 0.00508 -0.01083 -0.00517 ...</span></span>
<span><span class="co">#&gt;   ..$ deviance: num 79.8</span></span>
<span><span class="co">#&gt;   ..$ ed      : num 4.04</span></span>
<span><span class="co">#&gt;   ..$ aic     : num 87.9</span></span>
<span><span class="co">#&gt;   ..$ bic     : num 98.1</span></span>
<span><span class="co">#&gt;   ..$ Bbases  :List of 1</span></span>
<span><span class="co">#&gt;   .. ..$ Bs: num [1:91, 1:13] 0.1407 0.0971 0.0636 0.0388 0.0215 ...</span></span>
<span><span class="co">#&gt;   .. .. ..- attr(*, "x")= num [1:91] 15 45 75 105 135 165 195 225 255 285 ...</span></span>
<span><span class="co">#&gt;   .. .. ..- attr(*, "xl")= num 0</span></span>
<span><span class="co">#&gt;   .. .. ..- attr(*, "xr")= num 2730</span></span>
<span><span class="co">#&gt;   .. .. ..- attr(*, "nseg")= num 10</span></span>
<span><span class="co">#&gt;   .. .. ..- attr(*, "bdeg")= num 3</span></span>
<span><span class="co">#&gt;   .. .. ..- attr(*, "type")= chr "bbase"</span></span>
<span><span class="co">#&gt;  $ optimal_logrho: num 1.13</span></span>
<span><span class="co">#&gt;  $ P_optim       : num [1:13, 1:13] 13.4 -26.8 13.4 0 0 ...</span></span>
<span><span class="co">#&gt;  - attr(*, "class")= chr "haz1ts"</span></span></code></pre></div>
<p>The object returned by <code><a href="../reference/fit1ts.html">fit1ts()</a></code> is of class
<code>"haz1ts"</code>. The first element is a list with the results of
the optimal model. The second element is the optimal smoothing parameter
(on the <span class="math inline">\(\log_{10}\)</span>-scale) and the
last element is the penalty matrix <code>P_optim</code>, incorporating
the optimal value of <span class="math inline">\(\varrho\)</span>.</p>
<p>In the following examples we show how to modify the arguments of the
function, to obtain slightly different model’s specification. The
results are not shown here, but we encourage the reader to run these
examples on their console.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Model 3 - Change specifications of the B-splines (degree, number of segments </span></span>
<span><span class="co">#                                                   and range)</span></span>
<span><span class="va">m3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit1ts.html">fit1ts</a></span><span class="op">(</span>data1ts <span class="op">=</span> <span class="va">dt1ts</span>,</span>
<span>             Bbases_spec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>bdeg <span class="op">=</span> <span class="fl">2</span>,          <span class="co"># quadratic B-splines</span></span>
<span>                                nseg_s <span class="op">=</span> <span class="fl">20</span>,       <span class="co"># 20 segments</span></span>
<span>                                min_s <span class="op">=</span> <span class="fl">0</span>,         </span>
<span>                                max_s <span class="op">=</span> <span class="fl">2730</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Model 4 - As m3, but change penalty order</span></span>
<span><span class="va">m4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit1ts.html">fit1ts</a></span><span class="op">(</span>data1ts <span class="op">=</span> <span class="va">dt1ts</span>,</span>
<span>             Bbases_spec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>bdeg <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                                nseg_s <span class="op">=</span> <span class="fl">20</span>,</span>
<span>                                min_s <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                                max_s <span class="op">=</span> <span class="fl">2730</span><span class="op">)</span>,</span>
<span>             pord <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>                             <span class="co"># third-degree penalty</span></span>
<span></span>
<span><span class="co"># Model 5 - As m3, but change optimization method to grid_search</span></span>
<span><span class="va">m5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit1ts.html">fit1ts</a></span><span class="op">(</span>data1ts <span class="op">=</span> <span class="va">dt1ts</span>,</span>
<span>             Bbases_spec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>bdeg <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                                nseg_s <span class="op">=</span> <span class="fl">20</span>,</span>
<span>                                min_s <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                                max_s <span class="op">=</span> <span class="fl">2730</span><span class="op">)</span>,</span>
<span>             optim_method <span class="op">=</span> <span class="st">"grid_search"</span><span class="op">)</span>         <span class="co"># search for optimal smoothing                                                                       over grid of values</span></span>
<span></span>
<span><span class="co"># Model 6 - As m5, but optimization criterion is "bic" and include grid of </span></span>
<span><span class="co">#           values for log_10(rho)</span></span>
<span><span class="va">m6</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit1ts.html">fit1ts</a></span><span class="op">(</span>data1ts <span class="op">=</span> <span class="va">dt1ts</span>,</span>
<span>             Bbases_spec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>bdeg <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                                nseg_s <span class="op">=</span> <span class="fl">20</span>,</span>
<span>                                min_s <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                                max_s <span class="op">=</span> <span class="fl">2730</span><span class="op">)</span>,</span>
<span>             optim_method <span class="op">=</span> <span class="st">"grid_search"</span>,</span>
<span>             optim_criterion <span class="op">=</span> <span class="st">"bic"</span>,              <span class="co"># use BIC rather than AIC</span></span>
<span>             lrho <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">3</span>, by<span class="op">=</span><span class="fl">.2</span><span class="op">)</span><span class="op">)</span>             <span class="co"># provide grid for log_10(rho)</span></span></code></pre></div>
<p>Finally, we demonstrate how to plot the AIC and BIC curves, mark the
optimal values of the smoothing parameter, and extract the AIC and BIC
vectors after a grid search of the optimal smoothing parameter.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">m6</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit1ts.html">fit1ts</a></span><span class="op">(</span>data1ts <span class="op">=</span> <span class="va">dt1ts</span>,</span>
<span>             Bbases_spec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>bdeg <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                                nseg_s <span class="op">=</span> <span class="fl">20</span>,</span>
<span>                                min_s <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                                max_s <span class="op">=</span> <span class="fl">2730</span><span class="op">)</span>,</span>
<span>             optim_method <span class="op">=</span> <span class="st">"grid_search"</span>,</span>
<span>             optim_criterion <span class="op">=</span> <span class="st">"bic"</span>,</span>
<span>             lrho <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">3</span>, by<span class="op">=</span><span class="fl">.2</span><span class="op">)</span>,</span>
<span>             par_gridsearch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>               plot_aic <span class="op">=</span> <span class="cn">T</span>,</span>
<span>               plot_bic <span class="op">=</span> <span class="cn">T</span>,</span>
<span>               mark_optimal <span class="op">=</span> <span class="cn">T</span></span>
<span>             <span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="onetime_files/figure-html/fit1ts-grid-1.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">m6.aic</span> <span class="op">&lt;-</span> <span class="va">m6</span><span class="op">$</span><span class="va">AIC</span></span>
<span><span class="va">m6.bic</span> <span class="op">&lt;-</span> <span class="va">m6</span><span class="op">$</span><span class="va">BIC</span></span>
<span></span>
<span><span class="va">m6.aic</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>; <span class="va">m6.bic</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 97.67005 96.78100 95.81061 94.79922 93.79740 92.84326</span></span>
<span><span class="co">#&gt; [1] 135.6309 132.7852 129.7015 126.4681 123.1973 119.9904</span></span></code></pre></div>
<p>We notice how, for the same data and over the same grid of <span class="math inline">\(\log_{10}(\varrho)\)</span> values, the BIC
criterion selects a larger smoothing parameter than the AIC. This
behavior is well known, as the BIC penalizes differences in neighboring
coefficients more strongly than AIC, leading to smoother results.</p>
<p>Finally, we estimate a PH model including the covariates
<code>rx</code>, <code>node4</code> and <code>sex</code>, and see how to
extract the estimates of the regression parameters <span class="math inline">\(\beta\)</span>s.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m7</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit1ts.html">fit1ts</a></span><span class="op">(</span>data1ts <span class="op">=</span> <span class="va">dt1ts_cov</span>,</span>
<span>             Bbases_spec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nseg_s <span class="op">=</span> <span class="fl">15</span>,</span>
<span>                                min_s <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                                max_s <span class="op">=</span> <span class="fl">2730</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">betas</span> <span class="op">&lt;-</span> <span class="va">m7</span><span class="op">$</span><span class="va">optimal_model</span><span class="op">$</span><span class="va">beta</span></span>
<span><span class="va">betas</span></span>
<span><span class="co">#&gt;        Lev    Lev+5FU      node4       male </span></span>
<span><span class="co">#&gt; 0.07875399 0.27900614 0.50543144 0.21322565</span></span></code></pre></div>
<p>In the next section, we will show how to get estimates of the
(log-)hazard curve with one time scale, using the same <span class="math inline">\(B\)</span>-splines basis as for the estimation, or
evaluating this old basis in a denser grid. We will also see how to
obtain estimates of the hazard ratios, and how all these steps can be
performed jointly and plotted using the function
<code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>.</p>
</div>
<div class="section level3">
<h3 id="presenting-the-results-of-the-smooth-one-time-scale-hazard-model">Presenting the results of the smooth one time scale hazard
model<a class="anchor" aria-label="anchor" href="#presenting-the-results-of-the-smooth-one-time-scale-hazard-model"></a>
</h3>
<p>We will explore several options for the presentation of the results
of the one time scale model, using the last model we estimated in the
previous section, which included four covariates. The object returned by
<code><a href="../reference/fit1ts.html">fit1ts()</a></code> provides the estimates of both the parameters of
the <span class="math inline">\(B\)</span>-splines, that is a vector of
<span class="math inline">\(\hat{\alpha}\)</span> values, and the
estimates of the covariates’ effects, a vector of <span class="math inline">\(\hat{\beta}\)</span> values. The hazard is
obtained from the <span class="math inline">\(\hat{\alpha}\)</span> by
multiplying each coefficient to the corresponding <span class="math inline">\(B\)</span>-spline, summing up the contributions of
each scaled <span class="math inline">\(B\)</span>-spline in a specific
point and finally exponentiating the result: <span class="math display">\[\hat\lambda = \exp\left\{\sum^{n_s}_{k=1}
b_{kl}\alpha_l\right\}.\]</span></p>
<p>The function <code><a href="../reference/get_hazard_1d.html">get_hazard_1d()</a></code> returns a vector of
estimates for the (log-)hazard, and the associated standard errors,
given as input the object returned by <code><a href="../reference/fit1ts.html">fit1ts()</a></code> and,
optionally, a list of specifications for evaluating the <span class="math inline">\(B\)</span>-splines basis on a new grid. When
applied to a PH model, it returns the baseline hazard.</p>
<p>We show how to provide specifications for the <span class="math inline">\(B\)</span>-splines and how to use the function
<code><a href="../reference/get_hazard_1d.html">get_hazard_1d()</a></code>. We will evaluate the <span class="math inline">\(B\)</span>-splines basis on a finer grid, where
the distance between the bins is of 10 days.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">basehaz</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_hazard_1d.html">get_hazard_1d</a></span><span class="op">(</span>fitted_model <span class="op">=</span> <span class="va">m7</span>,</span>
<span>                         plot_grid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"smin"</span> <span class="op">=</span> <span class="fl">0</span>, <span class="st">"smax"</span> <span class="op">=</span> <span class="fl">2730</span>, <span class="st">"ds"</span> <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">basehaz</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 7</span></span>
<span><span class="co">#&gt;  $ new_plot_grid :List of 4</span></span>
<span><span class="co">#&gt;   ..$ ints: num [1:274] 0 10 20 30 40 50 60 70 80 90 ...</span></span>
<span><span class="co">#&gt;   ..$ smin: Named num 0</span></span>
<span><span class="co">#&gt;   .. ..- attr(*, "names")= chr "smin"</span></span>
<span><span class="co">#&gt;   ..$ smax: Named num 2730</span></span>
<span><span class="co">#&gt;   .. ..- attr(*, "names")= chr "smax"</span></span>
<span><span class="co">#&gt;   ..$ ds  : Named num 10</span></span>
<span><span class="co">#&gt;   .. ..- attr(*, "names")= chr "ds"</span></span>
<span><span class="co">#&gt;  $ hazard        : num [1:274, 1] 0.00095 0.000964 0.000978 0.000992 0.001007 ...</span></span>
<span><span class="co">#&gt;  $ loghazard     : num [1:274, 1] -6.96 -6.94 -6.93 -6.92 -6.9 ...</span></span>
<span><span class="co">#&gt;  $ log10hazard   : num [1:274, 1] -3.02 -3.02 -3.01 -3 -3 ...</span></span>
<span><span class="co">#&gt;  $ SE_hazard     : num [1:274, 1] 0.000169 0.000168 0.000166 0.000165 0.000164 ...</span></span>
<span><span class="co">#&gt;  $ SE_loghazard  : num [1:274, 1] 0.178 0.174 0.17 0.166 0.163 ...</span></span>
<span><span class="co">#&gt;  $ SE_log10hazard: num [1:274, 1] 0.0775 0.0756 0.0738 0.0721 0.0706 ...</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">basehaz</span><span class="op">$</span><span class="va">hazard</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.000191134 0.001517088</span></span></code></pre></div>
<p>The calls returns a list with several elements: The new grid for
plotting <code>new_plot_grid</code>, a vector for the hazard values
<code>hazard</code>, a vector for the log-hazard values
<code>loghazard</code> , a vector with the <span class="math inline">\(log_{10}\)</span>-hazard values
<code>log10hazard</code> and three vectors with the associated standard
errors, respectively <code>SE_hazard</code>, <code>SE_loghazard</code>
ans <code>SE_log10hazard</code>. The hazard ratios and their standard
errors are obtained by calling the function <code>get_hr</code>:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_hr.html">get_hr</a></span><span class="op">(</span>fitted_model <span class="op">=</span> <span class="va">m7</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hr</span><span class="op">$</span><span class="va">HR</span></span>
<span><span class="co">#&gt;      Lev  Lev+5FU    node4     male </span></span>
<span><span class="co">#&gt; 1.081938 1.321815 1.657701 1.237664</span></span></code></pre></div>
<p>It is possible to call these two functions independently and to use
the resulting objects to create a plot of the results. However, this is
exactly what is done by the method <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>, implemented for
objects of class <code>"haz1ts"</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m7</span><span class="op">)</span></span></code></pre></div>
<p><img src="onetime_files/figure-html/plot_haz1ts-1.png" width="480" style="display: block; margin: auto;"></p>
<p>This simple call produces, for a PH model, the plot of the baseline
hazard curve. Now we interpolate the <span class="math inline">\(B\)</span>-spline basis on a denser plotting grid,
and change other parameters to obtain a nicer plot.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m7</span>,</span>
<span>     plot_grid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"smin"</span> <span class="op">=</span> <span class="fl">0</span>, <span class="st">"smax"</span> <span class="op">=</span> <span class="fl">2730</span>, <span class="st">"ds"</span> <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>     plot_options<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>       col <span class="op">=</span> <span class="st">"purple"</span>,</span>
<span>       main <span class="op">=</span> <span class="st">"Baseline hazard"</span>,</span>
<span>       ylab <span class="op">=</span> <span class="st">"hazard"</span>,</span>
<span>       xlab <span class="op">=</span> <span class="st">"time since recurrence"</span>,</span>
<span>       cex_main <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="onetime_files/figure-html/plot_haz1ts-3-1.png" width="480" style="display: block; margin: auto;"></p>
<p>The hazard can also be plotted on the log-scale, by setting the
argument <code>plot_options$loghazard = TRUE</code>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m7</span>,</span>
<span>     plot_grid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"smin"</span> <span class="op">=</span> <span class="fl">0</span>, <span class="st">"smax"</span> <span class="op">=</span> <span class="fl">2730</span>, <span class="st">"ds"</span> <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>     plot_options<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>       loghazard <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>       col <span class="op">=</span> <span class="st">"purple"</span>,</span>
<span>       main <span class="op">=</span> <span class="st">"Baseline hazard"</span>,</span>
<span>       ylab <span class="op">=</span> <span class="st">"log-hazard"</span>,</span>
<span>       xlab <span class="op">=</span> <span class="st">"time since recurrence"</span>,</span>
<span>       cex_main <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="onetime_files/figure-html/plot_haz1ts-3log-1.png" width="480" style="display: block; margin: auto;"></p>
<p>We can also plot the covariates’ effects by calling:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m7</span>,</span>
<span>     which_plot <span class="op">=</span> <span class="st">"covariates"</span><span class="op">)</span></span></code></pre></div>
<p><img src="onetime_files/figure-html/plot_haz1ts-4-1.png" width="480" style="display: block; margin: auto;"></p>
<p>This call plots the point estimates for the <span class="math inline">\(\beta\)</span> parameters with their 95%
confidence intervals. Alternatively, we can decide to plot the estimated
hazard ratios, with their confidence intervals. There are two options
regarding the confidence intervals for the HRs: First, we can use the
delta method to find confidence intervals that are symmetric around the
HRs estimates. Second, we can exponentiate the confidence intervals for
the <span class="math inline">\(\beta\)</span> parameters, and therefore
obtain non-symmetric (but always positive) confidence intervals for the
HRs. We show both options here:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,</span>
<span>    font.main <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co"># Option 1: symmetric CIs with delta method</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m7</span>,</span>
<span>     which_plot <span class="op">=</span> <span class="st">"covariates"</span>,</span>
<span>     plot_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>       HR <span class="op">=</span> <span class="cn">T</span>,</span>
<span>       symmetric_CI <span class="op">=</span> <span class="cn">T</span>,</span>
<span>       ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">2.1</span><span class="op">)</span>,</span>
<span>       main <span class="op">=</span> <span class="st">"HR with symmetric CIs"</span>,</span>
<span>       cex_main <span class="op">=</span> <span class="fl">1</span></span>
<span>     <span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">1</span>, lty<span class="op">=</span><span class="fl">2</span>, col<span class="op">=</span><span class="st">"grey"</span><span class="op">)</span></span>
<span><span class="co"># Option 2: non-symmetric CIs </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m7</span>,</span>
<span>     which_plot <span class="op">=</span> <span class="st">"covariates"</span>,</span>
<span>     plot_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>       HR <span class="op">=</span> <span class="cn">T</span>,</span>
<span>       symmetric_CI <span class="op">=</span> <span class="cn">F</span>,</span>
<span>       ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">2.1</span><span class="op">)</span>,</span>
<span>       main <span class="op">=</span> <span class="st">"HR with non-symmetric CIs"</span>,</span>
<span>       cex_main <span class="op">=</span> <span class="fl">1</span></span>
<span>     <span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">1</span>, lty<span class="op">=</span><span class="fl">2</span>, col<span class="op">=</span><span class="st">"grey"</span><span class="op">)</span></span></code></pre></div>
<p><img src="onetime_files/figure-html/CIs-lev-1.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Finally, it is possible to change the level of confidence for the
CIs. In the following we show three different levels for the same <span class="math inline">\(\beta\)</span>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>,</span>
<span>    font.main <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m7</span>,</span>
<span>     which_plot <span class="op">=</span> <span class="st">"covariates"</span>,</span>
<span>     plot_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>       ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.22</span>, <span class="fl">0.8</span><span class="op">)</span>,</span>
<span>       main <span class="op">=</span> <span class="st">"95% CIs"</span>,</span>
<span>       cex_main <span class="op">=</span> <span class="fl">1</span></span>
<span>     <span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">0</span>, lty<span class="op">=</span><span class="fl">2</span>, col<span class="op">=</span><span class="st">"grey"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m7</span>,</span>
<span>     which_plot <span class="op">=</span> <span class="st">"covariates"</span>,</span>
<span>     plot_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>       ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.22</span>, <span class="fl">0.8</span><span class="op">)</span>,</span>
<span>       confidence <span class="op">=</span> <span class="fl">.90</span>,</span>
<span>       main <span class="op">=</span> <span class="st">"90% CIs"</span>,</span>
<span>       cex_main <span class="op">=</span> <span class="fl">1</span></span>
<span>     <span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">0</span>, lty<span class="op">=</span><span class="fl">2</span>, col<span class="op">=</span><span class="st">"grey"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m7</span>,</span>
<span>     which_plot <span class="op">=</span> <span class="st">"covariates"</span>,</span>
<span>     plot_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>       ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.22</span>, <span class="fl">0.8</span><span class="op">)</span>,</span>
<span>       confidence <span class="op">=</span> <span class="fl">.99</span>,</span>
<span>       main <span class="op">=</span> <span class="st">"99% CIs"</span>,</span>
<span>       cex_main <span class="op">=</span> <span class="fl">1</span></span>
<span>     <span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">0</span>, lty<span class="op">=</span><span class="fl">2</span>, col<span class="op">=</span><span class="st">"grey"</span><span class="op">)</span></span></code></pre></div>
<p><img src="onetime_files/figure-html/HRs-plot-1.png" width="624" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Carollo:2023" class="csl-entry">
Carollo, Angela, Paul H. C. Eilers, Hein Putter, and Jutta Gampe. 2023.
<span>“Smooth Hazards with Multiple Time Scales.”</span> <em>arXiv
Preprint: arXiv:2305.09342</em>, May. <a href="https://arxiv.org/abs/http://arxiv.org/abs/2305.09342v1" class="external-link">https://arxiv.org/abs/http://arxiv.org/abs/2305.09342v1</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Angela Carollo, Paul H.C. Eilers, Jutta Gampe.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
