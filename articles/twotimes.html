<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Smooth hazards with two time scales ‚Ä¢ TwoTimeScales</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Smooth hazards with two time scales">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">TwoTimeScales</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html" aria-label="Homepage"><span class="fa fa-home"></span></a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Vignettes</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fa-file-code-o"></span> functions</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/AngelaCar/TwoTimeScales"><span class="fa fa-github fa-lg fab"></span> github</a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Smooth hazards with two time scales</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/AngelaCar/TwoTimeScales/blob/main/vignettes/twotimes.Rmd" class="external-link"><code>vignettes/twotimes.Rmd</code></a></small>
      <div class="d-none name"><code>twotimes.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/AngelaCar/TwoTimeScales" class="external-link">TwoTimeScales</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette focuses on the analysis of time-to-event data with two
time scales. We show how to use the functions of the package
<code>TwoTimeScales</code> with their different options. In particular
we show:</p>
<ul>
<li>how to bin data over the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>u</mi><mo>,</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(u,s)</annotation></semantics></math>-
or the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>,</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(t,s)</annotation></semantics></math>-plane</li>
<li>how to bin data when covariates are presents</li>
<li>how to perform a grid search of the optimal couple of smoothing
parameters</li>
<li>how to plot the AIC or BIC grid</li>
<li>how to perform a numerical optimization of the model</li>
<li>how to use the functionalities of the LMMsolver package to find the
optimal smoothing parameters</li>
<li>how to estimate a model with covariates</li>
</ul>
<p>This vignette does not deal with visualization of the estimated
smooth hazard with two time scales. Visualization is the topic of the
vignette <em>Visualize hazards with two time scales</em>. We assume that
the reader of this vignette has some familiarity with the model, and
with the basic functions of the package introduced in <em>Introduction
to TwoTimeScales</em>. For a full exposition of the model, we refer to
<span class="citation">Carollo et al. (2023)</span>.</p>
<p>In the following, we once again analyse the dataset
<code>reccolon2ts</code>, which includes data on patients with
recurrence of colon cancer. The first part of this vignette deals with
the model without covariates, and the proportional hazards model for the
same analysis follows in the second part.</p>
</div>
<div class="section level2">
<h2 id="hazard-of-death-by-time-since-randomization-and-time-since-recurrence">Hazard of death by time since randomization and time since
recurrence<a class="anchor" aria-label="anchor" href="#hazard-of-death-by-time-since-randomization-and-time-since-recurrence"></a>
</h2>
<p>The two time variables are
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
= time since randomization and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>
= time since recurrence. Additionally,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>u</mi><annotation encoding="application/x-tex">u</annotation></semantics></math>
= time at recurrence, is the fixed time at entry in the risk set
recorded as number of days from randomization to recurrence. The
analysis is performed over the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>u</mi><mo>,</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(u,s)</annotation></semantics></math>-plane,
so we need to bin the data over
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>u</mi><annotation encoding="application/x-tex">u</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>.
We consider bins of width 30 days on both axes, and we obtain 77 bins on
the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>u</mi><annotation encoding="application/x-tex">u</annotation></semantics></math>
axis and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>91</mn><annotation encoding="application/x-tex">91</annotation></semantics></math>
bins on the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>
axis.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dt2ts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_data.html">prepare_data</a></span><span class="op">(</span>u <span class="op">=</span> <span class="va">reccolon2ts</span><span class="op">$</span><span class="va">timer</span>,</span>
<span>                      s_out <span class="op">=</span> <span class="va">reccolon2ts</span><span class="op">$</span><span class="va">timesr</span>,</span>
<span>                      events <span class="op">=</span> <span class="va">reccolon2ts</span><span class="op">$</span><span class="va">status</span>,</span>
<span>                      ds <span class="op">=</span> <span class="fl">30</span>, du <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span>
<span><span class="co">#&gt; `s_in = NULL`. I will use `s_in = 0` for all observations.</span></span>
<span><span class="co">#&gt; `s_in = NULL`. I will use `s_in = 0` for all observations.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">dt2ts</span><span class="op">)</span></span>
<span><span class="co">#&gt; An object of class 'data2ts'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Data:</span></span>
<span><span class="co">#&gt; List of 2</span></span>
<span><span class="co">#&gt;  $ bins   :List of 6</span></span>
<span><span class="co">#&gt;  $ bindata:List of 2</span></span>
<span><span class="co">#&gt;  - attr(*, "class")= chr "data2ts"</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Range covered by the bins: </span></span>
<span><span class="co">#&gt; $bins_u</span></span>
<span><span class="co">#&gt; [1]    8 2288</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $bins_s</span></span>
<span><span class="co">#&gt; [1]    0 2730</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of bins: </span></span>
<span><span class="co">#&gt; $nu</span></span>
<span><span class="co">#&gt; [1] 76</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ns</span></span>
<span><span class="co">#&gt; [1] 91</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Overview of the binned data:</span></span>
<span><span class="co">#&gt; [1] "Total exposure time: 246018"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [1] "Total number of events: 409"</span></span></code></pre></div>
<p>Here, we do not use the artificially created left truncated entry
times on the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>
axis, therefore the function returns a message informing the user that
an entry time of 0 is imputed to all observations.</p>
<p>After having prepared the data we can estimate the model. In the
analysis presented in <span class="citation">Carollo et al.
(2023)</span>, we build 23
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>B</mi><annotation encoding="application/x-tex">B</annotation></semantics></math>-splines
over each of the two dimensions, for a total of 529
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ±</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
parameters. The optimal smoothing parameters are chosen by numerical
optimization of the AIC of the model as function of the smoothing
parameters. We use cubic
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>B</mi><annotation encoding="application/x-tex">B</annotation></semantics></math>-splines
bases and a second order penalty. Here we explicitly specify all these
parameters, even though some of them are the default options.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit2ts.html">fit2ts</a></span><span class="op">(</span>data2ts <span class="op">=</span> <span class="va">dt2ts</span>,</span>
<span>               Bbases_spec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>bdeg <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                                  nseg_s <span class="op">=</span> <span class="fl">20</span>,</span>
<span>                                  min_s <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                                  max_s <span class="op">=</span> <span class="fl">2730</span>,</span>
<span>                                  nseg_u <span class="op">=</span> <span class="fl">20</span>,</span>
<span>                                  min_u <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                                  max_u <span class="op">=</span> <span class="fl">2300</span><span class="op">)</span>,</span>
<span>               pord <span class="op">=</span> <span class="fl">2</span>,</span>
<span>               optim_method <span class="op">=</span> <span class="st">"ucminf"</span>,</span>
<span>               optim_criterion <span class="op">=</span> <span class="st">"aic"</span><span class="op">)</span> </span></code></pre></div>
<p>The object returned by <code><a href="../reference/fit2ts.html">fit2ts()</a></code> is of class
<code>"haz2ts"</code>. The optimal smoothing parameters are
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>ùúö</mo><mi>u</mi></msub><mo>=</mo><msup><mn>10</mn><mn>2.4</mn></msup></mrow><annotation encoding="application/x-tex">\varrho_u = 10^{2.4}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>ùúö</mo><mi>s</mi></msub><mo>=</mo><msup><mn>10</mn><mn>0.3</mn></msup></mrow><annotation encoding="application/x-tex">\varrho_s=10^{0.3}</annotation></semantics></math>,
and the effective dimension of the model is 11.1.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Model specifications:</span></span>
<span><span class="co">#&gt;   number of events =  409 </span></span>
<span><span class="co">#&gt;   nu =  76 </span></span>
<span><span class="co">#&gt;   ns =  91 </span></span>
<span><span class="co">#&gt;   cu =  23 </span></span>
<span><span class="co">#&gt;   cs =  23 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Optimal smoothing: </span></span>
<span><span class="co">#&gt;   log10(rho_u) =  2.402208 </span></span>
<span><span class="co">#&gt;   log10(rho_s) =  0.3102949 </span></span>
<span><span class="co">#&gt;   rho_u =  252.4691 </span></span>
<span><span class="co">#&gt;   rho_s =  2.043125 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model with no covariates</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model fit: </span></span>
<span><span class="co">#&gt;   AIC =  1249.297 </span></span>
<span><span class="co">#&gt;   BIC =  1314.656 </span></span>
<span><span class="co">#&gt;   ED =  11.13921</span></span></code></pre></div>
<p>We can change the optimization criterion to BIC, and compare the
results in terms of smoothing parameters and effective dimensions:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit2ts.html">fit2ts</a></span><span class="op">(</span>data2ts <span class="op">=</span> <span class="va">dt2ts</span>,</span>
<span>               Bbases_spec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>bdeg <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                                  nseg_s <span class="op">=</span> <span class="fl">20</span>,</span>
<span>                                  min_s <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                                  max_s <span class="op">=</span> <span class="fl">2730</span>,</span>
<span>                                  nseg_u <span class="op">=</span> <span class="fl">20</span>,</span>
<span>                                  min_u <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                                  max_u <span class="op">=</span> <span class="fl">2300</span><span class="op">)</span>,</span>
<span>               pord <span class="op">=</span> <span class="fl">2</span>,</span>
<span>               optim_method <span class="op">=</span> <span class="st">"ucminf"</span>,</span>
<span>               optim_criterion <span class="op">=</span> <span class="st">"bic"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod2</span><span class="op">$</span><span class="va">optimal_logrho</span></span>
<span><span class="co">#&gt; [1] 5.785580 1.521686</span></span>
<span><span class="va">mod2</span><span class="op">$</span><span class="va">optimal_model</span><span class="op">$</span><span class="va">ed</span></span>
<span><span class="co">#&gt; [1] 5.501157</span></span></code></pre></div>
<p>As expected, choosing BIC as optimization criterion results in larger
smoothing parameters and a smaller effective dimension, as BIC penalizes
model complexity more strongly than AIC. The following code-chunk shows
how to use the grid search method to select the optimal pair of
smoothing parameters and at the same time to produce plots of the AIC
and BIC values of the grid of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mo>log</mo><mn>10</mn></msub><annotation encoding="application/x-tex">\log_{10}</annotation></semantics></math>
values of both smoothing parameters. We do not evaluate this code chunk
as it can be time consuming, but we encourage the readers to run the
code on their console.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit2ts.html">fit2ts</a></span><span class="op">(</span>data2ts <span class="op">=</span> <span class="va">dt2ts</span>,</span>
<span>               Bbases_spec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>bdeg <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                                  nseg_s <span class="op">=</span> <span class="fl">20</span>,</span>
<span>                                  min_s <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                                  max_s <span class="op">=</span> <span class="fl">2730</span>,</span>
<span>                                  nseg_u <span class="op">=</span> <span class="fl">20</span>,</span>
<span>                                  min_u <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                                  max_u <span class="op">=</span> <span class="fl">2300</span><span class="op">)</span>,</span>
<span>               optim_method <span class="op">=</span> <span class="st">"grid_search"</span>,</span>
<span>               optim_criterion <span class="op">=</span> <span class="st">"aic"</span>,</span>
<span>               lrho <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">3</span>, by<span class="op">=</span><span class="fl">.2</span><span class="op">)</span>,</span>
<span>                           <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">3</span>, by <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>               par_gridsearch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                 plot_aic <span class="op">=</span> <span class="cn">T</span>,</span>
<span>                 plot_bic <span class="op">=</span> <span class="cn">T</span>,</span>
<span>                 mark_optimal <span class="op">=</span> <span class="cn">T</span>,</span>
<span>                 plot_contour <span class="op">=</span> <span class="cn">T</span></span>
<span>               <span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Alternatively, we can ask the function to return the matrices of AIC
and/or BIC values as part of the fitted object and then plot them
separately (here not shown).</p>
<p>Lastly, we show how to fit the same model by using the package
LMMsolver <span class="citation">Martin P. Boer (2023)</span>, that uses
the connection between linear mixed models and P-splines, and uses
sparse representation to speed-up calculations. It is possible to fit
this model by using the same function <code><a href="../reference/fit2ts.html">fit2ts()</a></code> and
specifying the option <code>optim_method = "LMMsolver"</code>. This
returns an object of class <code>haz2tsLMM</code>, which differ in
structure from objects of class <code>haz2ts</code>, but has the same
methods implemented.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod_LMM</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit2ts.html">fit2ts</a></span><span class="op">(</span>data2ts <span class="op">=</span> <span class="va">dt2ts</span>,</span>
<span>                  Bbases_spec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>bdeg <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                                     nseg_s <span class="op">=</span> <span class="fl">20</span>,</span>
<span>                                     min_s <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                                     max_s <span class="op">=</span> <span class="fl">2730</span>,</span>
<span>                                     nseg_u <span class="op">=</span> <span class="fl">20</span>,</span>
<span>                                     min_u <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                                     max_u <span class="op">=</span> <span class="fl">2300</span><span class="op">)</span>,</span>
<span>                  pord <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                  optim_method <span class="op">=</span> <span class="st">"LMMsolver"</span>,</span>
<span>                  optim_criterion <span class="op">=</span> <span class="st">"aic"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod_LMM</span><span class="op">)</span></span>
<span><span class="co">#&gt; Model specifications:</span></span>
<span><span class="co">#&gt;   number of events =  409 </span></span>
<span><span class="co">#&gt;   nu =  76 </span></span>
<span><span class="co">#&gt;   ns =  91 </span></span>
<span><span class="co">#&gt;   cu =  23 </span></span>
<span><span class="co">#&gt;   cs =  23 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Optimal smoothing: </span></span>
<span><span class="co">#&gt;   log10(rho_u) =  2.14465 </span></span>
<span><span class="co">#&gt;   log10(rho_s) =  0.5217892 </span></span>
<span><span class="co">#&gt;   rho_u =  139.5243 </span></span>
<span><span class="co">#&gt;   rho_s =  3.324981 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model with no covariates</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model fit: </span></span>
<span><span class="co">#&gt;   AIC =  1249.449 </span></span>
<span><span class="co">#&gt;   BIC =  1314.151 </span></span>
<span><span class="co">#&gt;   ED =  11.02726</span></span></code></pre></div>
<p>Note: the functions from LMMsolver needed to fit the two time scales
hazard model are incorporated in the <code>TwoTimeScales</code> package.
Nevertheless, we do recommend interested readers to check out the
excellent R-package <code>LMMsolver</code> and its accompanying webpage:
<a href="https://biometris.github.io/LMMsolver/" class="external-link uri">https://biometris.github.io/LMMsolver/</a></p>
</div>
<div class="section level2">
<h2 id="ph-regression-for-the-colon-cancer-data">PH regression for the colon cancer data<a class="anchor" aria-label="anchor" href="#ph-regression-for-the-colon-cancer-data"></a>
</h2>
<p>We first show how to prepare the data for the analysis with
covariates, then we see that there is no need to modify the estimation
command, as the function <code><a href="../reference/fit2ts.html">fit2ts()</a></code> automatically recognizes
that the data object includes a covariates‚Äô matrix and then it correctly
estimates a GLAM PH model.</p>
<p>To prepare the covariates‚Äô matrix, we need to pass a matrix with the
individual values of the covariates, to the argument <code>covs</code>
in <code>prepare_data</code>. We do so by subsetting the dataset and
selecting the desired covariates.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">covs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">reccolon2ts</span>, select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rx"</span>, <span class="st">"sex"</span>, <span class="st">"adhere"</span>, <span class="st">"obstruct"</span>, <span class="st">"node4"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dt2ts_cov</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_data.html">prepare_data</a></span><span class="op">(</span>u <span class="op">=</span> <span class="va">reccolon2ts</span><span class="op">$</span><span class="va">timer</span>,</span>
<span>                          s_out <span class="op">=</span> <span class="va">reccolon2ts</span><span class="op">$</span><span class="va">timesr</span>,</span>
<span>                          events <span class="op">=</span> <span class="va">reccolon2ts</span><span class="op">$</span><span class="va">status</span>,</span>
<span>                          ds <span class="op">=</span> <span class="fl">30</span>,</span>
<span>                          individual <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                          covs <span class="op">=</span> <span class="va">covs</span><span class="op">)</span></span>
<span><span class="co">#&gt; `s_in = NULL`. I will use `s_in = 0` for all observations.</span></span>
<span><span class="co">#&gt; `s_in = NULL`. I will use `s_in = 0` for all observations.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">dt2ts_cov</span><span class="op">)</span></span>
<span><span class="co">#&gt; An object of class 'data2ts'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Data:</span></span>
<span><span class="co">#&gt; List of 2</span></span>
<span><span class="co">#&gt;  $ bins   :List of 6</span></span>
<span><span class="co">#&gt;  $ bindata:List of 3</span></span>
<span><span class="co">#&gt;  - attr(*, "class")= chr "data2ts"</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Range covered by the bins: </span></span>
<span><span class="co">#&gt; $bins_u</span></span>
<span><span class="co">#&gt; [1]    8 2288</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $bins_s</span></span>
<span><span class="co">#&gt; [1]    0 2730</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of bins: </span></span>
<span><span class="co">#&gt; $nu</span></span>
<span><span class="co">#&gt; [1] 76</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ns</span></span>
<span><span class="co">#&gt; [1] 91</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Overview of the binned data:</span></span>
<span><span class="co">#&gt; [1] "Total exposure time: 246018"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [1] "Total number of events: 409"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Covariates:</span></span>
<span><span class="co">#&gt; [1] "Lev"      "Lev_5FU"  "male"     "adhere"   "obstruct" "node4"</span></span></code></pre></div>
<p>Then, we pass the object <code>d2ts_cov</code> to
<code><a href="../reference/fit2ts.html">fit2ts()</a></code> with the same arguments as before. We do not show
the fitted object here, but encourage the readers to run the code on
their console.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod_cov</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit2ts.html">fit2ts</a></span><span class="op">(</span>data2ts <span class="op">=</span> <span class="va">dt2ts_cov</span>,</span>
<span>                  Bbases_spec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>bdeg <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                                     nseg_s <span class="op">=</span> <span class="fl">20</span>,</span>
<span>                                     min_s <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                                     max_s <span class="op">=</span> <span class="fl">2730</span>,</span>
<span>                                     nseg_u <span class="op">=</span> <span class="fl">20</span>,</span>
<span>                                     min_u <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                                     max_u <span class="op">=</span> <span class="fl">2300</span><span class="op">)</span>,</span>
<span>                  pord <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                  optim_method <span class="op">=</span> <span class="st">"ucminf"</span>,</span>
<span>                  optim_criterion <span class="op">=</span> <span class="st">"aic"</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="prepare-the-data-over-the-lexis-diagram">Prepare the data over the Lexis diagram<a class="anchor" aria-label="anchor" href="#prepare-the-data-over-the-lexis-diagram"></a>
</h3>
<p>It is, in principle, possible to prepare the data over the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>,</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(t,s)</annotation></semantics></math>-plane.
To do so, we pass as arguments to the function
<code><a href="../reference/prepare_data.html">prepare_data()</a></code> a vector of entry times and a vector of exit
times over the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
axis, rather than the vector of entry times
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>u</mi><annotation encoding="application/x-tex">u</annotation></semantics></math>.
From the image plot of the exposure times, we can see how the data are
only present in the lower half-plane where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>‚â•</mo><mi>s</mi></mrow><annotation encoding="application/x-tex">t\ge s</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dt2tsLex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_data.html">prepare_data</a></span><span class="op">(</span>t_in <span class="op">=</span> <span class="va">reccolon2ts</span><span class="op">$</span><span class="va">timer</span>,</span>
<span>                         t_out <span class="op">=</span> <span class="va">reccolon2ts</span><span class="op">$</span><span class="va">timedc</span>,</span>
<span>                         s_out <span class="op">=</span> <span class="va">reccolon2ts</span><span class="op">$</span><span class="va">timesr</span>,</span>
<span>                         events <span class="op">=</span> <span class="va">reccolon2ts</span><span class="op">$</span><span class="va">status</span>,</span>
<span>                         ds <span class="op">=</span> <span class="fl">30</span>, dt <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span>
<span><span class="co">#&gt; `s_in = NULL`. I will use `s_in = 0` for all observations.</span></span>
<span><span class="co">#&gt; `s_in = NULL`. I will use `s_in = 0` for all observations.</span></span>
<span><span class="co">#&gt; NOTE: entry.status has been set to 0 for all.</span></span>
<span><span class="fu">fields</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/fields/man/image.plot.html" class="external-link">image.plot</a></span><span class="op">(</span><span class="va">dt2tsLex</span><span class="op">$</span><span class="va">bins</span><span class="op">$</span><span class="va">midt</span>, </span>
<span>                   <span class="va">dt2tsLex</span><span class="op">$</span><span class="va">bins</span><span class="op">$</span><span class="va">mids</span>,</span>
<span>                   <span class="va">dt2tsLex</span><span class="op">$</span><span class="va">bindata</span><span class="op">$</span><span class="va">R</span>,</span>
<span>                   main <span class="op">=</span> <span class="st">"Exposure"</span>,</span>
<span>                   xlab <span class="op">=</span> <span class="st">"time since randomization"</span>,</span>
<span>                   ylab <span class="op">=</span> <span class="st">"time since recurrence"</span>,</span>
<span>                   col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">plasma</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>,b<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/box.html" class="external-link">box</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="twotimes_files/figure-html/prep-data-Lexis-1.png" width="480"></p>
<p>Note: estimation over the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>,</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(t,s)</annotation></semantics></math>-plane
with the same model is theoretically possible, but special care is
needed to deal with the larger areas without data support (especially
those where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>&lt;</mo><mi>s</mi></mrow><annotation encoding="application/x-tex">t &lt; s</annotation></semantics></math>).
Comparison with the estimation over the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>u</mi><mo>,</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(u,s)</annotation></semantics></math>-plane
is currently under investigation. A future version of the package will
include options for estimation over the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>,</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(t,s)</annotation></semantics></math>-plane.</p>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-Carollo:2023" class="csl-entry">
Carollo, Angela, Paul H. C. Eilers, Hein Putter, and Jutta Gampe. 2023.
<span>‚ÄúSmooth Hazards with Multiple Time Scales.‚Äù</span> <em>arXiv
Preprint: arXiv:2305.09342</em>, May. <a href="https://arxiv.org/abs/arXiv:2305.09342" class="external-link">https://arxiv.org/abs/arXiv:2305.09342</a>.
</div>
<div id="ref-Boer:2023" class="csl-entry">
Martin P. Boer. 2023. <span>‚ÄúTensor Product <span>P</span>-Splines Using
a Sparse Mixed Model Formulation.‚Äù</span> <em>Statistical Modelling</em>
23 (5-6): 465‚Äì79. <a href="https://doi.org/10.1177/1471082X231178591" class="external-link">https://doi.org/10.1177/1471082X231178591</a>.
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Angela Carollo, Paul H.C. Eilers, Jutta Gampe.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
