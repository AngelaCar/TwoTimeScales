<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to TwoTimeScales • TwoTimeScales</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to TwoTimeScales">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">TwoTimeScales</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html" aria-label="Homepage"><span class="fa fa-home"></span></a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Vignettes</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fa-file-code-o"></span> functions</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/AngelaCar/TwoTimeScales"><span class="fa fa-github fa-lg fab"></span> github</a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Introduction to TwoTimeScales</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/AngelaCar/TwoTimeScales/blob/main/vignettes/TwoTimeScales.Rmd" class="external-link"><code>vignettes/TwoTimeScales.Rmd</code></a></small>
      <div class="d-none name"><code>TwoTimeScales.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/AngelaCar/TwoTimeScales" class="external-link">TwoTimeScales</a></span><span class="op">)</span></span></code></pre></div>
<p>Time-to-event data can involve more than one time scale. In such
cases, the hazard of one event can be expressed as a function of two
time dimensions. The two time scales act jointly to determine the hazard
levels.</p>
<p>The <code>TwoTimeScales</code> package allows the user to estimate
and visualize the hazard of one event as a smooth function of two time
dimensions (the two time scales). Additionally, it provides functions to
estimate and visualize a smooth hazard with one time scale.</p>
<p>The hazard is estimated as a two-dimensional
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>P</mi><annotation encoding="application/x-tex">P</annotation></semantics></math>-splines
model for count data with offset.</p>
<p>When working with time-to-event data with multiple time scales, there
are three main steps involved:</p>
<ul>
<li>data wrangling and preparation</li>
<li>estimation of the smooth hazard model</li>
<li>visualization of the results</li>
</ul>
<p>This document introduces the main tools in the package
<code>TwoTimeScales</code> and demonstrates how to apply them to smooth
hazards with one or two time scales. This vignette serves as an
introduction to the package, and it is therefore a good place to start
for new users of the package. We also provide three additional, more
specialized vignettes.</p>
<div class="section level3">
<h3 id="data-reccolon2ts">Data: reccolon2ts<a class="anchor" aria-label="anchor" href="#data-reccolon2ts"></a>
</h3>
<p>We use data from a clinical trial on colon cancer and the effects of
two adjuvant therapies after colon resection <span class="citation">(Laurie et al. 1989; Moertel et al. 1995)</span>. The
original data are included in the R-package <code>survival</code> <span class="citation">(Therneau 2020)</span>, see
<code>help(survival::colon)</code>. Patients were followed, after
resection of the colon, from randomization into one of the two treatment
groups or the control group (no treatment), to death or end of the
study. The two treatments were either Levamisole, a drug showing
immunostimulatory activity, or a combination of Levamisole and
Fluorouracil, a moderately toxic chemotherapy agent.</p>
<p>The dataset <code>colon</code> contains 929 individuals, and 468
(50.4%) experienced a recurrence of the cancer during follow-up period.
However, seven patients with recurrence left the risk set at the
recorded time of recurrence, leaving 461 who were followed up further.
In the dataset <code>reccolon2ts</code> we include these 461
individuals. A description of the data and the variables can be accessed
through <code><a href="../reference/reccolon2ts.html">help(reccolon2ts)</a></code>.</p>
<p>There are two time scales in the <code>reccolon2ts</code> data: The
time from randomization to death or censoring, measured in days since
randomization <code>reccolon2ts$timedc</code> and the time since
recurrence of the cancer <code>reccolon2ts$timesr</code>, also measured
in days. Additionally, we consider another variable, measuring the time
from randomization to recurrence <code>reccolon2ts$timer</code>. The
latter is not a time scale, but a fixed time covariate which varies
among individuals in the data.</p>
<p>In the original dataset, each individual enters the risk set after
recurrence at the exact time of the recurrence. Therefore, individual’s
observations are not left truncated. However, to show how the model can
easily incorporate left truncation, we introduced some artificial left
truncated entry times for 40 individuals in the dataset,
<code>reccolon2ts$entrys</code> (on the time since recurrence scale),
and <code>reccolon2ts$entryt</code> (on the time since randomization
scale).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">reccolon2ts</span><span class="op">)</span></span></code></pre></div>
<pre><code>'data.frame':   461 obs. of  25 variables:
 $ id      : num  1 3 4 5 6 7 13 14 16 17 ...
 $ study   : num  1 1 1 1 1 1 1 1 1 1 ...
 $ rx      : Factor w/ 3 levels "Obs","Lev","Lev+5FU": 3 1 3 1 3 2 1 2 1 2 ...
 $ sex     : Factor w/ 2 levels "female","male": 2 1 1 2 1 2 2 2 2 2 ...
 $ age     : num  43 71 66 69 57 77 64 68 68 62 ...
 $ obstruct: num  0 0 1 0 0 0 0 1 0 1 ...
 $ perfor  : num  0 0 0 0 0 0 0 0 0 0 ...
 $ adhere  : num  0 1 0 0 0 0 0 0 0 1 ...
 $ nodes   : num  5 7 6 22 9 5 1 3 1 6 ...
 $ status  : num  1 1 1 1 1 1 1 1 0 1 ...
 $ differ  : Factor w/ 3 levels "well","moderate",..: 2 2 2 2 2 2 2 2 2 2 ...
 $ extent  : Factor w/ 4 levels "submucosa","muscle",..: 3 2 3 3 3 3 3 3 3 3 ...
 $ surg    : Factor w/ 2 levels "short","long": 1 1 2 2 1 2 1 1 2 1 ...
 $ node4   : num  1 1 1 1 1 1 0 0 0 1 ...
 $ timedc  : num  1521 963 293 659 1767 ...
 $ etype   : num  2 2 2 2 2 2 2 2 2 2 ...
 $ timer   : num  968 542 245 523 904 ...
 $ entrys  : num  0 0 0 0 0 0 0 0 0 88 ...
 $ timesr  : num  553 421 48 136 863 ...
 $ entryt  : num  968 542 245 523 904 ...
 $ timedc_y: num  4.164 2.637 0.802 1.804 4.838 ...
 $ timesr_y: num  1.514 1.153 0.131 0.372 2.363 ...
 $ entrys_y: num  0 0 0 0 0 ...
 $ entryt_y: num  2.65 1.484 0.671 1.432 2.475 ...
 $ timer_y : num  2.65 1.484 0.671 1.432 2.475 ...</code></pre>
<p>Before we illustrate how to work with the package, a clarification
about notation is needed. In our two time scales model notation, we
indicate the two time scales with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>,
and the fixed time at entry in the process is indicated with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>u</mi><annotation encoding="application/x-tex">u</annotation></semantics></math>.
Whenever we refer to models with one time scale only, we mostly consider
this to be the time scale indicated by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>
(as opposed to the most common used notation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>).
Therefore, in all the functions that require the individual times as
inputs, the only required inputs will be indicated with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>
(rather than
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>).</p>
</div>
<div class="section level3">
<h3 id="step-1-data-preparation">Step 1: data preparation<a class="anchor" aria-label="anchor" href="#step-1-data-preparation"></a>
</h3>
<p>Time-to-event data come in the form of a time variable, indicated
with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo>≥</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">s \ge 0</annotation></semantics></math>
and a variable which contains the event indicator. In the simplest
time-to-event models, there is only one type of event, so that this
event indicator can only assume values 0 and 1.</p>
<p>To apply the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>P</mi><annotation encoding="application/x-tex">P</annotation></semantics></math>-splines
model for the hazard we need to bin the individual data into aggregated
vectors of exposure times and event indicators. Therefore, the first
step of the analysis, will be data preparation. This step involves the
construction of the bins and the actual binning of the data. Both steps
are implemented and performed by the function
<code><a href="../reference/prepare_data.html">prepare_data()</a></code>, which requires as inputs the individual
data vectors, and the desired specification for the bins. This function
works in the same way for the case of data with one time scale only, and
for data with two time scales. The only difference is in the inputs
required in each of the cases. We will now illustrate its use in both
cases.</p>
<div class="section level4">
<h4 id="one-time-scale-only">One time scale only<a class="anchor" aria-label="anchor" href="#one-time-scale-only"></a>
</h4>
<p>For data over one time scale, the function requires as minimal inputs
only a vector of exit times (<code>s_out</code>), a vector of events’
indicators (<code>events</code>) and the desired bins’ size
(<code>ds</code>). If the data are left truncated, the entry times can
be passed to the argument <code>s_in</code>. These can be either
extracted from a dataset by using the argument <code>data</code> and
passing the vector’s names in each respective argument, as illustrated
below, or by directly passing the vectors.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dt1ts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_data.html">prepare_data</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">reccolon2ts</span>,</span>
<span>                      s_out <span class="op">=</span> <span class="st">"timesr"</span>,</span>
<span>                      events <span class="op">=</span> <span class="st">"status"</span>,</span>
<span>                      ds <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span></code></pre></div>
<pre><code>&gt; str(dt1ts)

List of 2
 $ bins   :List of 3
  ..$ bins_s: num [1:92] 0 30 60 90 120 150 180 210 240 270 ...
  ..$ mids  : num [1:91] 15 45 75 105 135 165 195 225 255 285 ...
  ..$ ns    : int 91
 $ bindata:List of 2
  ..$ r: num [1:91] 13674 13070 12474 12002 11534 ...
  ..$ y: num [1:91] 14 24 16 11 24 22 20 10 24 26 ...
 - attr(*, "class")= chr "data2ts"

&gt; print(dt1ts)
An object of class 'data2ts'

Data:
List of 2
 $ bins   :List of 3
 $ bindata:List of 2
 - attr(*, "class")= chr "data2ts"
NULL

Range covered by the bins: 
$bins_s
[1]    0 2730


Number of bins: 
$ns
[1] 91


Overview of the binned data:
Total exposure time: 246018
Total number of events: 409</code></pre>
<p>The object <code>dt1ts</code> is a list with two elements. The first
element is a list of bins (<code>bins_s</code>) with their midpoints
(<code>mids</code>) and the number of bins (<code>ns</code>). The second
element of the list is another list with the data binned, a vector of
exposures called <code>r</code> and a vector of events’ counts
<code>y</code>. By calling the method <code>print(dt1ts)</code>, we
obtain additional information about the data, such as the range covered
by the bins, the total exposure time and the total number of events.</p>
</div>
<div class="section level4">
<h4 id="two-time-scales">Two time scales<a class="anchor" aria-label="anchor" href="#two-time-scales"></a>
</h4>
<p>The same function is used to bin the individual data in a
two-dimensional grid of rectangles (or squares) over
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>u</mi><annotation encoding="application/x-tex">u</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>,
or parallelograms in a Lexis diagram over
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>.
The two time scales model is estimated over the half-plane
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>u</mi><mo>,</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(u,s)</annotation></semantics></math>.
Therefore, we will here discuss only preparation of the data over
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>u</mi><annotation encoding="application/x-tex">u</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>,
and defer the discussion of the preparation over the Lexis diagram to
the vignette dedicated to the analysis with two time scales.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dt2ts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_data.html">prepare_data</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">reccolon2ts</span>,</span>
<span>                      u <span class="op">=</span> <span class="st">"timer"</span>,</span>
<span>                      s_out <span class="op">=</span> <span class="st">"timesr"</span>,</span>
<span>                      events <span class="op">=</span> <span class="st">"status"</span>,</span>
<span>                      ds <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span></code></pre></div>
<pre><code>&gt; str(dt2ts)
List of 2
 $ bins   :List of 6
  ..$ bins_u: num [1:77] 8 38 68 98 128 158 188 218 248 278 ...
  ..$ midu  : num [1:76] 23 53 83 113 143 173 203 233 263 293 ...
  ..$ nu    : int 76
  ..$ bins_s: num [1:92] 0 30 60 90 120 150 180 210 240 270 ...
  ..$ mids  : num [1:91] 15 45 75 105 135 165 195 225 255 285 ...
  ..$ ns    : int 91
 $ bindata:List of 2
  ..$ R: num [1:76, 1:91] 205 243 540 796 474 812 506 746 657 517 ...
  ..$ Y: num [1:76, 1:91] 1 1 0 1 1 2 1 1 1 2 ...
 - attr(*, "class")= chr "data2ts"

&gt; print(dt2ts)
An object of class 'data2ts'

Data:
List of 2
 $ bins   :List of 6
 $ bindata:List of 2
 - attr(*, "class")= chr "data2ts"
NULL

Range covered by the bins: 
$bins_u
[1]    8 2288

$bins_s
[1]    0 2730


Number of bins: 
$nu
[1] 76

$ns
[1] 91


Overview of the binned data:
Total exposure time: 246018
Total number of events: 409</code></pre>
<p>We have now included only one additional input <code>u</code>, that
is the vector with the individuals’ time at recurrence of the cancer.
The object <code>dt2ts</code> has the same structure as
<code>dt1ts</code>, but with additional bins over
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>u</mi><annotation encoding="application/x-tex">u</annotation></semantics></math>
(<code>bins_u</code>, <code>midu</code> and <code>nu</code>). The data
are now matrices <code>R</code> and <code>Y</code> of dimension
<code>nu</code> by <code>ns</code>.</p>
</div>
<div class="section level4">
<h4 id="including-covariates">Including covariates<a class="anchor" aria-label="anchor" href="#including-covariates"></a>
</h4>
<p>If we want to estimate a proportional hazard model with covariates a
different structure of the data is required (see <span class="citation">Carollo et al. (2024)</span>). The data are augmented
by one dimension. So, for the model with one time scale only, we need to
create a matrix of exposure times <code>R</code> with dimension
<code>n</code> (number of individuals in the data) by <code>ns</code>
(number of bins). The same goes for the matrix of event counts. For the
model with two time scales, each observation in the sample will be
represented by its own matrix of exposure times and matrix of event
indicators. Therefore, the data for the whole sample can be arranged in
three-dimensional arrays, with dimensions <code>nu</code> by
<code>ns</code> by <code>n</code>. The function
<code><a href="../reference/prepare_data.html">prepare_data()</a></code> does exactly so by specifying the optional
input <code>individual = TRUE</code>. It is possible, and recommended,
to provide the covariates that one wishes to use in the PH model in the
extra argument <code>covs</code>. The function will take care of the
preparation of the regression matrix <code>Z</code>. However, if
desired, this can also be prepared externally (in which case a warning
will be returned).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dt2ts_cov</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_data.html">prepare_data</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">reccolon2ts</span>,</span>
<span>                          u <span class="op">=</span> <span class="st">"timer"</span>,</span>
<span>                          s_in <span class="op">=</span> <span class="st">"entrys"</span>,</span>
<span>                          s_out <span class="op">=</span> <span class="st">"timesr"</span>,</span>
<span>                          events <span class="op">=</span> <span class="st">"status"</span>,</span>
<span>                          ds <span class="op">=</span> <span class="fl">30</span>,</span>
<span>                          individual <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                          covs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rx"</span>, <span class="st">"node4"</span>, <span class="st">"sex"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>&gt; str(dt2ts_cov)
List of 2
 $ bins   :List of 6
  ..$ bins_u: num [1:77] 8 38 68 98 128 158 188 218 248 278 ...
  ..$ midu  : num [1:76] 23 53 83 113 143 173 203 233 263 293 ...
  ..$ nu    : int 76
  ..$ bins_s: num [1:92] 0 30 60 90 120 150 180 210 240 270 ...
  ..$ mids  : num [1:91] 15 45 75 105 135 165 195 225 255 285 ...
  ..$ ns    : int 91
 $ bindata:List of 3
  ..$ R: num [1:76, 1:91, 1:461] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ Y: num [1:76, 1:91, 1:461] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ Z: num [1:461, 1:6] 0 0 0 0 0 1 0 1 0 1 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : NULL
  .. .. ..$ : chr [1:6] "rx_Lev" "rx_Lev+5FU" "sex_male" "adhere" ...
 - attr(*, "class")= chr "data2ts"

&gt; print(dt2ts_cov)
An object of class 'data2ts'

Data:
List of 2
 $ bins   :List of 6
 $ bindata:List of 3
 - attr(*, "class")= chr "data2ts"
NULL

Range covered by the bins: 
$bins_u
[1]    8 2288

$bins_s
[1]    0 2730


Number of bins: 
$nu
[1] 76

$ns
[1] 91


Overview of the binned data:
Total exposure time: 246018
Total number of events: 409
Covariates:
[1] "rx_Lev"     "rx_Lev+5FU" "sex_male"   "adhere"    
[5] "obstruct"   "node4" </code></pre>
<p>The data are now the three-dimensional arrays, <code>R</code> and
<code>Y</code> and a regression matrix <code>Z</code>, where the
covariates are transformed in dummy variables (where needed). The print
method returns also the names of the dummy variables, so we can see that
from the variable <code>rx</code> we obtained the two dummies
<code>rx_Lev</code> and <code>rx_Lev+5FU</code> and from the variable
<code>sex</code> we obtained now the dummy variable
<code>sex_male</code> (<code>Obs</code> and <code>female</code> are
reference categories, as well as not having more than four nodes).</p>
</div>
</div>
<div class="section level3">
<h3 id="step-2-estimation">Step 2: Estimation<a class="anchor" aria-label="anchor" href="#step-2-estimation"></a>
</h3>
<div class="section level4">
<h4 id="one-time-scale">One time scale<a class="anchor" aria-label="anchor" href="#one-time-scale"></a>
</h4>
<p>To estimate the model we use the function <code><a href="../reference/fit1ts.html">fit1ts()</a></code>. As
input to this function we pass the object returned from
<code>prepare_data</code>. Without specifying additional parameters, the
function estimates a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>P</mi><annotation encoding="application/x-tex">P</annotation></semantics></math>-splines
model, by using numerical optimization of the AIC to find the optimal
smoothing parameter. The
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>B</mi><annotation encoding="application/x-tex">B</annotation></semantics></math>-splines
basis is built using default options (see <code><a href="../reference/fit1ts.html">help(fit1ts)</a></code> for
details). However, for illustration, we now show how to specify the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>B</mi><annotation encoding="application/x-tex">B</annotation></semantics></math>-splines
basis to more closely match the data structure.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m1ts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit1ts.html">fit1ts</a></span><span class="op">(</span>data1ts <span class="op">=</span> <span class="va">dt1ts</span>,</span>
<span>               Bbases_spec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>bdeg <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                                  nseg_s <span class="op">=</span> <span class="fl">20</span>,</span>
<span>                                  min_s <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                                  max_s <span class="op">=</span> <span class="fl">2730</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>&gt; str(m1ts)
List of 3
 $ optimal_model :List of 9
  ..$ alpha   : num [1:23, 1] -6.77 -6.58 -6.39 -6.25 -6.19 ...
  ..$ SE_alpha: num [1:23] 0.2276 0.123 0.0763 0.0744 0.0797 ...
  ..$ eta     : num [1:91, 1] -6.56 -6.52 -6.48 -6.44 -6.4 ...
  ..$ H       : num [1:23, 1:23] 0.07508 0.04686 0.02027 0.00324 -0.00366 ...
  ..$ deviance: num 79.4
  ..$ ed      : num 4.25
  ..$ aic     : num 87.9
  ..$ bic     : num 98.6
  ..$ Bbases  :List of 1
  .. ..$ Bs: num [1:91, 1:23] 1.18e-01 5.02e-02 1.52e-02 2.05e-03 2.21e-07 ...
  .. .. ..- attr(*, "x")= num [1:91] 15 45 75 105 135 165 195 225 255 285 ...
  .. .. ..- attr(*, "xl")= num 0
  .. .. ..- attr(*, "xr")= num 2730
  .. .. ..- attr(*, "nseg")= num 20
  .. .. ..- attr(*, "bdeg")= num 3
  .. .. ..- attr(*, "type")= chr "bbase"
 $ optimal_logrho: num 2.02
 $ P_optim       : num [1:23, 1:23] 105 -211 105 0 0 ...
 - attr(*, "class")= chr "haz1ts"</code></pre>
<p>Here, we specify a cubic (<code>bdeg = 3</code>)
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>B</mi><annotation encoding="application/x-tex">B</annotation></semantics></math>-splines
basis that covers the range of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>
from 0 to 2730 days (<code>min_s</code> and <code>max_s</code>
respectively), and is built on 20 segments (<code>nseg_s = 20</code>).
The object returned by <code>fit1ts</code> is of class
<code>"haz1ts"</code>. The first element is a list with the results of
the optimal model. The second element is the optimal smoothing parameter
(on the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mo>log</mo><mn>10</mn></msub><annotation encoding="application/x-tex">\log_{10}</annotation></semantics></math>-scale)
and the last element is the penalty matrix, which incorporates the
optimal value of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>𝜚</mo><annotation encoding="application/x-tex">\varrho</annotation></semantics></math>,
<code>P_optim</code>.</p>
<p>The vignette <em>Smooth hazards with one time scale</em> discusses
alternative options for estimation, in particular concerning the search
for the optimal smoothing parameter.</p>
</div>
<div class="section level4">
<h4 id="two-time-scales-1">Two time scales<a class="anchor" aria-label="anchor" href="#two-time-scales-1"></a>
</h4>
<p>Estimation over the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>u</mi><mo>,</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(u,s)</annotation></semantics></math>-plane
is performed in the same way. Here, we illustrate how to use the
function <code><a href="../reference/fit2ts.html">fit2ts()</a></code>, and again we will change the default
specifications of the marginal
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>B</mi><annotation encoding="application/x-tex">B</annotation></semantics></math>-spline
bases, but otherwise use default values for the remaining inputs.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m2ts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit2ts.html">fit2ts</a></span><span class="op">(</span>data2ts <span class="op">=</span> <span class="va">dt2ts</span>,</span>
<span>               Bbases_spec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>bdeg <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                                  nseg_s <span class="op">=</span> <span class="fl">20</span>,</span>
<span>                                  min_s <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                                  max_s <span class="op">=</span> <span class="fl">2730</span>,</span>
<span>                                  nseg_u <span class="op">=</span> <span class="fl">16</span>,</span>
<span>                                  min_u <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                                  max_u <span class="op">=</span> <span class="fl">2300</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>&gt; summary(m2ts)
Number of events =  409 
Model specifications:
  nu =  76 
  ns =  91 
  cu =  19 
  cs =  23 

Optimal smoothing: 
  log10(rho_u) =  2.101313 
  log10(rho_s) =  0.4089259 
  rho_u =  126.2736 
  rho_s =  2.564046 

Model with no covariates

Model diagnostics: 
  AIC =  1249.329 
  BIC =  1313.998 
  ED =  11.02155</code></pre>
<p>Whereas the estimates from <code>fit1ts</code> are vectors, the ones
from <code>fit2ts</code> are organized in matrices: The matrix
<code>optimal_model$Alpha</code>, containing the estimated
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>B</mi><annotation encoding="application/x-tex">B</annotation></semantics></math>-splines’
coefficients
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>α</mi><mrow><mi>l</mi><mi>m</mi></mrow></msub><annotation encoding="application/x-tex">\alpha_{lm}</annotation></semantics></math>,
for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mo>∈</mo><mn>1</mn><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>c</mi><mi>u</mi></msub></mrow><annotation encoding="application/x-tex">l \in 1,\dots,c_u</annotation></semantics></math>
(here
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mi>u</mi></msub><mo>=</mo><mn>19</mn></mrow><annotation encoding="application/x-tex">c_u = 19</annotation></semantics></math>)
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>∈</mo><mn>1</mn><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>c</mi><mi>s</mi></msub></mrow><annotation encoding="application/x-tex">m \in 1,\dots, c_s</annotation></semantics></math>
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mi>s</mi></msub><mo>=</mo><mn>23</mn></mrow><annotation encoding="application/x-tex">c_s = 23</annotation></semantics></math>).
And the matrix Eta of dimension
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mi>u</mi></msub><annotation encoding="application/x-tex">n_u</annotation></semantics></math>
by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mi>s</mi></msub><annotation encoding="application/x-tex">n_s</annotation></semantics></math>
(90 by 91). Additionally, we have a list with the marginal
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>B</mi><annotation encoding="application/x-tex">B</annotation></semantics></math>-splines
used for estimation (<code>optimal_model$Bbases</code>), a vector of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>log</mo><mn>10</mn></msub><msub><mo>𝜚</mo><mi>u</mi></msub></mrow><annotation encoding="application/x-tex">\log_{10}\varrho_u</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>log</mo><mn>10</mn></msub><msub><mo>𝜚</mo><mi>s</mi></msub></mrow><annotation encoding="application/x-tex">\log_{10}\varrho_s</annotation></semantics></math>
values (<code>optimal_logrho</code>) and finally the penalty matrix
(<code>P_optim</code>) that incorporates the optimal penalty
parameters.</p>
<p>The summary method is implemented for objects of class
<code>haz2ts</code>, and it returns the model specifications, the
optimal smoothing parameters, the effective dimension (ED) and the model
fit as measured by the AIC and BIC of the model.</p>
</div>
</div>
<div class="section level3">
<h3 id="step-3-visualize-the-results">Step 3: Visualize the results<a class="anchor" aria-label="anchor" href="#step-3-visualize-the-results"></a>
</h3>
<div class="section level4">
<h4 id="one-time-scale-1">One time scale<a class="anchor" aria-label="anchor" href="#one-time-scale-1"></a>
</h4>
<p>Once the model is estimated, we can represent the results with the
function <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>. The minimal input for <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>
is the fitted model. Here, we show how to evaluate the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>B</mi><annotation encoding="application/x-tex">B</annotation></semantics></math>-splines
basis on a finer grid of points that are only 10 days apart (as opposite
to 30, option that was used for the estimating
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>B</mi><annotation encoding="application/x-tex">B</annotation></semantics></math>-splines).
Moreover, we pass as inputs some graphical parameters to obtain a nicer
plot. The result is a plot of the one-dimensional hazard curve over
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>
(time since recurrence), with accompany 95% confidence bands.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">m1ts</span>,</span>
<span>     plot_grid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"smin"</span> <span class="op">=</span> <span class="fl">0</span>, <span class="st">"smax"</span> <span class="op">=</span> <span class="fl">2730</span>, <span class="st">"ds"</span> <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>     plot_options<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>       col <span class="op">=</span> <span class="st">"darkblue"</span>,</span>
<span>       main <span class="op">=</span> <span class="st">"Hazard"</span>,</span>
<span>       ylab <span class="op">=</span> <span class="st">"hazard"</span>,</span>
<span>       xlab <span class="op">=</span> <span class="st">"time since recurrence"</span>,</span>
<span>       cex_main <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/TwoTimeScales/1ts-plot-1.png"> #### Two
time scales</p>
<p>There are several options to represent the smooth hazard with two
time scales. Here, we will present only the most simple, yet very
informative, way, which is also the default plot returned by the
function <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>, applied to an object of class
<code>'haz2ts'</code>. This is a surface plot of the hazard over the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>u</mi><mo>,</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(u,s)</annotation></semantics></math>-plane
with white contour lines. We provide a vignette that only focus on
visualization of the hazard with two time scales <em>Visualize hazards
with two time scales</em>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">m2ts</span>,</span>
<span>     plot_grid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"umin"</span> <span class="op">=</span> <span class="fl">0</span>, <span class="st">"umax"</span> <span class="op">=</span> <span class="fl">2300</span>, <span class="st">"du"</span> <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>                      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"smin"</span> <span class="op">=</span> <span class="fl">0</span>, <span class="st">"smax"</span> <span class="op">=</span> <span class="fl">2730</span>, <span class="st">"ds"</span> <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span>,</span>
<span>     plot_options<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>       main <span class="op">=</span> <span class="st">"Bi-dimensional hazard"</span>,</span>
<span>       ylab <span class="op">=</span> <span class="st">"time since recurrence"</span>,</span>
<span>       xlab <span class="op">=</span> <span class="st">"time since randomization"</span>,</span>
<span>       cex_main <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/TwoTimeScales/2ts-plot-1.png"></p>
</div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-Carollo:2024" class="csl-entry">
Carollo, Angela, Paul H. C. Eilers, Hein Putter, and Jutta Gampe. 2024.
<span>“Smooth Hazards with Multiple Time Scales.”</span> <em>Statistics
in Medicine</em>. <a href="https://doi.org/10.1002/sim.10297" class="external-link">https://doi.org/10.1002/sim.10297</a>.
</div>
<div id="ref-Laurie:1989" class="csl-entry">
Laurie, J. A., C. G. Moertel, T. R. Fleming, H. S. Wieand, J. E. Leigh,
J. Rubin, G. W. McCormack, J. B. Gerstner, J. E. Krook, and J. Malliard.
1989. <span>“<span class="nocase">Surgical adjuvant therapy of
large-bowel carcinoma: an evaluation of levamisole and the combination
of levamisole and fluorouracil. The North Central Cancer Treatment Group
and the Mayo Clinic.</span>”</span> <em>Journal of Clinical
Oncology</em> 7 (10): 1447–56. <a href="https://doi.org/10.1200/JCO.1989.7.10.1447" class="external-link">https://doi.org/10.1200/JCO.1989.7.10.1447</a>.
</div>
<div id="ref-Moertel:1995" class="csl-entry">
Moertel, Charles G., Thomas R. Fleming, John S. Macdonald, Daniel G.
Haller, John A. Laurie, Catherine M. Tangen, James S. Ungerleider, et
al. 1995. <span>“<span class="nocase">Fluorouracil plus
<span>L</span>evamisole as Effective Adjuvant Therapy after Resection of
Stage III Colon Carcinoma: A Final Report</span>.”</span> <em>Annals of
Internal Medicine</em> 122 (5): 321–26. <a href="https://doi.org/10.7326/0003-4819-122-5-199503010-00001" class="external-link">https://doi.org/10.7326/0003-4819-122-5-199503010-00001</a>.
</div>
<div id="ref-R:survival" class="csl-entry">
Therneau, Terry M. 2020. <em>A <span>P</span>ackage for
<span>S</span>urvival <span>A</span>nalysis in <span>R</span></em>. <a href="https://CRAN.R-project.org/package=survival" class="external-link">https://CRAN.R-project.org/package=survival</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Angela Carollo, Paul H.C. Eilers, Jutta Gampe.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
